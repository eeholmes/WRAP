<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Plotting OMs and SDMs • WRAP</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/cosmo/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Plotting OMs and SDMs">
<meta property="og:description" content="WRAP">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">WRAP</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.5</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../articles/index.html">Vignettes</a>
</li>
<li>
  <a href="../reference/index.html">Functions</a>
</li>
<li>
  <a href="../articles/pkgdown/Package.html">Package Building</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/eeholmes/WRAP">
    <span class="fa fa-github"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Plotting OMs and SDMs</h1>
            
            <h4 class="date">2020-05-25</h4>
      
      
      <div class="hidden name"><code>Plotting.Rmd</code></div>

    </div>

    
    
<p>This vignette shows how to make plots of OMs (simulated rasters of environmental variables and species abundances) and SDMs (fitted species distribution models) using the <strong>WRAP</strong> package.</p>
<p><strong>WRAP</strong> includes the following plotting functions</p>
<ul>
<li>
<code><a href="https://rdrr.io/r/graphics/plot.html">plot()</a></code> Plot yearly averages of the variables in an OM or POM</li>
<li>
<code><a href="../reference/plot_cog.html">plot_cog()</a></code> Center of gravity for each year for OMs, SDMs and POMs</li>
<li>
<code><a href="../reference/plot_abund.html">plot_abund()</a></code> Total abundance for each year for OMs, SDMs and POMs</li>
<li>
<code><a href="../reference/plot_grid.html">plot_grid()</a></code> Grid of abundance for one or a range of years for OMs, SDMs and POMs</li>
<li>
<code><a href="../reference/plot_pres.html">plot_pres()</a></code> Average presence for each year for OMs, SDMs and POMs</li>
</ul>
<p>This vignette will show the <strong>WRAP</strong> functions and also show you how to make the plots from your own code.</p>
<div id="example" class="section level1">
<h1 class="hasAnchor">
<a href="#example" class="anchor"></a>Example</h1>
<div class="sourceCode" id="cb1"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">WRAP</span>)</pre></body></html></div>
<div id="simulate-data" class="section level2">
<h2 class="hasAnchor">
<a href="#simulate-data" class="anchor"></a>Simulate data</h2>
<p>For theses examples, we’ll use an OM from <code><a href="../reference/SimulateWorld_ROMS.html">SimulateWorld_ROMS()</a></code> which uses ROMS for the environmental fields. Set the parameters to the following for our simulated abundances and presence/absence grid. <code>PA_shape</code> specifies how enviro suitability determines species presence-absence. It takes values of “logistic”, “logistic_prev”, or “linear”. <code>abund_enviro</code> specifies abundance relationship when presence=1. It can be “lnorm_low”, “lnorm_high”, or “poisson”.</p>
<div class="sourceCode" id="cb2"><html><body><pre class="r"><span class="no">abund_enviro</span> <span class="kw">&lt;-</span> <span class="st">"lnorm_low"</span>
<span class="no">PA_shape</span> <span class="kw">&lt;-</span> <span class="st">"logistic"</span></pre></body></html></div>
<p>Simulate species abundances:</p>
<div class="sourceCode" id="cb3"><html><body><pre class="r"><span class="no">sim1</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/SimulateWorld_ROMS.html">SimulateWorld_ROMS</a></span>(<span class="kw">PA_shape</span> <span class="kw">=</span> <span class="no">PA_shape</span>,
                      <span class="kw">abund_enviro</span> <span class="kw">=</span> <span class="no">abund_enviro</span>,
                      <span class="kw">roms.years</span> <span class="kw">=</span> <span class="fl">2000</span>:<span class="fl">2040</span>)</pre></body></html></div>
<p>Printing the output will show you basic information about the simulation. This information is in <code>sim1$meta</code>.</p>
<div class="sourceCode" id="cb4"><html><body><pre class="r"><span class="no">sim1</span>
<span class="co">## Simulated species abundance and suitability from WRAP version 1.5 and function SimulateWorld_ROMS</span>
<span class="co">##    covariates: sst</span>
<span class="co">##    grid.dimensions: 181, 186, 33666 (nrow, ncol, cells) </span>
<span class="co">##    grid.resolution 0.0994623655913978, 0.0994475138121547 (x, y) </span>
<span class="co">##    grid.extent -134, -115.5, 30, 48 (xmin, xmax, ymin, ymax) </span>
<span class="co">##    grid.units: degree</span>
<span class="co">##    time.extent: 2000 to 2040 year</span></pre></body></html></div>
</div>
<div id="plot-the-yearly-averages" class="section level2">
<h2 class="hasAnchor">
<a href="#plot-the-yearly-averages" class="anchor"></a>Plot the yearly averages</h2>
<p>Get the yearly means of the variables in an OM model.</p>
<div class="sourceCode" id="cb5"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(<span class="no">sim1</span>, <span class="kw">start.forecast.year</span><span class="kw">=</span><span class="fl">2020</span>)</pre></body></html></div>
<p><img src="Plotting_files/figure-html/unnamed-chunk-3-1.png" width="576"></p>
<p>Here is raw code to make the same plot.</p>
<div class="sourceCode" id="cb6"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">dplyr</span>) <span class="co">#for the %&gt;% pipe</span>
<span class="no">year_mean</span> <span class="kw">&lt;-</span> <span class="no">sim1</span>$<span class="no">grid</span> <span class="kw">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/stats/aggregate.html">aggregate</a></span>(<span class="no">.</span>~<span class="no">year</span>, <span class="no">.</span>, <span class="kw">FUN</span><span class="kw">=</span><span class="st">"mean"</span>) <span class="kw">%&gt;%</span>
  <span class="kw pkg">reshape2</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/reshape2/man/melt.html">melt</a></span>(<span class="no">.</span>, <span class="kw">id.vars</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"year"</span>),
                  <span class="kw">measure.vars</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"pres"</span>, <span class="st">"suitability"</span>, <span class="st">"sst"</span>, <span class="st">"abundance"</span>),
                  <span class="kw">variable.name</span><span class="kw">=</span><span class="st">"variable"</span>,
                  <span class="kw">value.name</span><span class="kw">=</span><span class="st">"value"</span>)
<span class="no">year_mean</span>$<span class="no">date</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span>(<span class="no">year_mean</span>$<span class="no">year</span>, <span class="st">"01-01"</span>, <span class="kw">sep</span><span class="kw">=</span><span class="st">"-"</span>))</pre></body></html></div>
<p>Plot. Blue is the training data and grey is the testing (forecast) data.</p>
<div class="sourceCode" id="cb7"><html><body><pre class="r"><span class="fu">ggplot</span>(<span class="no">year_mean</span>, <span class="fu">aes</span>(<span class="kw">x</span><span class="kw">=</span><span class="no">date</span>, <span class="kw">y</span><span class="kw">=</span><span class="no">value</span>)) + <span class="fu">geom_line</span>(<span class="kw">col</span><span class="kw">=</span><span class="st">"grey"</span>) +
  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="kw">x</span><span class="kw">=</span><span class="no">date</span>, <span class="kw">y</span><span class="kw">=</span><span class="no">value</span>), <span class="kw">col</span><span class="kw">=</span><span class="st">"blue"</span>, <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span>(<span class="no">year_mean</span>, <span class="no">year</span><span class="kw">&lt;=</span><span class="fl">2020</span>)) +
  <span class="fu">facet_wrap</span>(~<span class="no">variable</span>, <span class="kw">scales</span> <span class="kw">=</span> <span class="st">"free_y"</span>) +
  <span class="fu">xlab</span>(<span class="st">"year"</span>)</pre></body></html></div>
<p><img src="Plotting_files/figure-html/unnamed-chunk-5-1.png" width="576"></p>
<p>Here is an example without <code>ggplot()</code>.</p>
<div class="sourceCode" id="cb8"><html><body><pre class="r"><span class="co">#All Years</span>
<span class="no">dat</span> <span class="kw">&lt;-</span> <span class="no">sim1</span>$<span class="no">grid</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span>(<span class="kw">mfrow</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">2</span>,<span class="fl">2</span>))
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(<span class="fu"><a href="https://rdrr.io/r/stats/aggregate.html">aggregate</a></span>(<span class="no">suitability</span>~<span class="no">year</span>,<span class="no">dat</span>,<span class="kw">FUN</span><span class="kw">=</span><span class="st">"mean"</span>),<span class="kw">type</span><span class="kw">=</span><span class="st">"l"</span>, <span class="kw">lwd</span><span class="kw">=</span><span class="fl">2</span>, <span class="kw">ylab</span><span class="kw">=</span><span class="st">"Suitability"</span>,<span class="kw">col</span><span class="kw">=</span><span class="st">"dark grey"</span>)
<span class="fu"><a href="https://rdrr.io/r/graphics/lines.html">lines</a></span>(<span class="fu"><a href="https://rdrr.io/r/stats/aggregate.html">aggregate</a></span>(<span class="no">suitability</span>~<span class="no">year</span>,<span class="no">dat</span>[<span class="no">dat</span>$<span class="no">year</span><span class="kw">&lt;=</span><span class="fl">2020</span>,],<span class="kw">FUN</span><span class="kw">=</span><span class="st">"mean"</span>),<span class="kw">col</span><span class="kw">=</span><span class="st">"blue"</span>)
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(<span class="fu"><a href="https://rdrr.io/r/stats/aggregate.html">aggregate</a></span>(<span class="no">pres</span>~<span class="no">year</span>,<span class="no">dat</span>,<span class="kw">FUN</span><span class="kw">=</span><span class="st">"mean"</span>),<span class="kw">type</span><span class="kw">=</span><span class="st">"l"</span>, <span class="kw">lwd</span><span class="kw">=</span><span class="fl">2</span>,<span class="kw">ylab</span><span class="kw">=</span><span class="st">"Presence"</span>,<span class="kw">col</span><span class="kw">=</span><span class="st">"dark grey"</span>)
<span class="fu"><a href="https://rdrr.io/r/graphics/lines.html">lines</a></span>(<span class="fu"><a href="https://rdrr.io/r/stats/aggregate.html">aggregate</a></span>(<span class="no">pres</span>~<span class="no">year</span>,<span class="no">dat</span>[<span class="no">dat</span>$<span class="no">year</span><span class="kw">&lt;=</span><span class="fl">2020</span>,],<span class="kw">FUN</span><span class="kw">=</span><span class="st">"mean"</span>),<span class="kw">col</span><span class="kw">=</span><span class="st">"blue"</span>)
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(<span class="fu"><a href="https://rdrr.io/r/stats/aggregate.html">aggregate</a></span>(<span class="no">abundance</span>~<span class="no">year</span>,<span class="no">dat</span>,<span class="kw">FUN</span><span class="kw">=</span><span class="st">"sum"</span>),<span class="kw">type</span><span class="kw">=</span><span class="st">"l"</span>,  <span class="kw">lwd</span><span class="kw">=</span><span class="fl">2</span>,<span class="kw">ylab</span><span class="kw">=</span><span class="st">"Abundance"</span>, <span class="kw">col</span><span class="kw">=</span><span class="st">"dark grey"</span>)
<span class="fu"><a href="https://rdrr.io/r/graphics/lines.html">lines</a></span>(<span class="fu"><a href="https://rdrr.io/r/stats/aggregate.html">aggregate</a></span>(<span class="no">abundance</span>~<span class="no">year</span>,<span class="no">dat</span>[<span class="no">dat</span>$<span class="no">year</span><span class="kw">&lt;=</span><span class="fl">2020</span>,],<span class="kw">FUN</span><span class="kw">=</span><span class="st">"sum"</span>),<span class="kw">col</span><span class="kw">=</span><span class="st">"blue"</span>)
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(<span class="fu"><a href="https://rdrr.io/r/stats/aggregate.html">aggregate</a></span>(<span class="no">sst</span>~<span class="no">year</span>,<span class="no">dat</span>,<span class="kw">FUN</span><span class="kw">=</span><span class="st">"mean"</span>),<span class="kw">type</span><span class="kw">=</span><span class="st">"l"</span>,<span class="kw">ylab</span><span class="kw">=</span><span class="st">"Temperature"</span>, <span class="kw">col</span><span class="kw">=</span><span class="st">"dark grey"</span>)</pre></body></html></div>
<p><img src="Plotting_files/figure-html/unnamed-chunk-6-1.png" width="576"></p>
</div>
<div id="fit-sdms-to-the-simulated-grid" class="section level2">
<h2 class="hasAnchor">
<a href="#fit-sdms-to-the-simulated-grid" class="anchor"></a>Fit SDMs to the simulated grid</h2>
<p>We will fit GAM, BRT and MLP SDM models to the simulated grids. The default fitting period is years prior to 2021 (<code>start.forecast.year=2021</code>).</p>
<div class="sourceCode" id="cb9"><html><body><pre class="r"><span class="no">gam.fit</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/gam_sdm.html">gam_sdm</a></span>(<span class="no">sim1</span>, <span class="kw">covariates</span><span class="kw">=</span><span class="st">"sst"</span>)
<span class="no">brt.fit</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/brt_sdm.html">brt_sdm</a></span>(<span class="no">sim1</span>, <span class="kw">covariates</span><span class="kw">=</span><span class="st">"sst"</span>)
<span class="no">mlp.fit</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/mlp_sdm.html">mlp_sdm</a></span>(<span class="no">sim1</span>, <span class="kw">covariates</span><span class="kw">=</span><span class="st">"sst"</span>)</pre></body></html></div>
</div>
<div id="compare-abundance-predictons" class="section level2">
<h2 class="hasAnchor">
<a href="#compare-abundance-predictons" class="anchor"></a>Compare abundance predictons</h2>
<p>The function <code><a href="../reference/plot_abund.html">plot_abund()</a></code> will plot the total abundances of the true data (from simulation) and the fitted models. The functions works on OMs (from the simulation functions), SDMs (from the fitting functions), and POMs (from the prediction function).</p>
<div class="sourceCode" id="cb10"><html><body><pre class="r"><span class="fu"><a href="../reference/plot_abund.html">plot_abund</a></span>(<span class="no">sim1</span>, <span class="no">gam.fit</span>, <span class="no">mlp.fit</span>, <span class="no">brt.fit</span>)
<span class="co">## getting prediction with gam.fit </span>
<span class="co">## getting prediction with mlp.fit </span>
<span class="co">## getting prediction with brt.fit</span></pre></body></html></div>
<p><img src="Plotting_files/figure-html/unnamed-chunk-7-1.png" width="576"></p>
<div class="sourceCode" id="cb11"><html><body><pre class="r"># You can also pass in predictions, which would be faster</pre></body></html></div>
<p>Here is how to compute these abundance plots without <code>plot_abund</code>. First we create a data frame of the abundance predictions and true abundance.</p>
<div class="sourceCode" id="cb12"><html><body><pre class="r"><span class="no">pred.gam</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span>(<span class="no">sim1</span>, <span class="kw">sdm</span><span class="kw">=</span><span class="no">gam.fit</span>)
<span class="no">pred.brt</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span>(<span class="no">sim1</span>, <span class="kw">sdm</span><span class="kw">=</span><span class="no">brt.fit</span>)
<span class="no">pred.mlp</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span>(<span class="no">sim1</span>, <span class="kw">sdm</span><span class="kw">=</span><span class="no">mlp.fit</span>)

<span class="co"># Assemble into a data frame</span>
<span class="no">nr</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span>(<span class="no">pred.gam</span>)
<span class="no">pred.all</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span>(<span class="no">pred.gam</span>, <span class="no">pred.brt</span>, <span class="no">pred.mlp</span>)
<span class="no">pred.all</span>$<span class="no">model</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="st">"gam"</span>, <span class="no">nr</span>), <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="st">"brt"</span>, <span class="no">nr</span>), <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="st">"mlp"</span>, <span class="no">nr</span>))</pre></body></html></div>
<div class="sourceCode" id="cb13"><html><body><pre class="r"><span class="co"># sum up the abundance predictions across cells by year</span>
<span class="co"># model col is the model</span>
<span class="no">abund</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/aggregate.html">aggregate</a></span>(<span class="no">pred</span>~<span class="no">year</span>+<span class="no">model</span>, <span class="no">pred.all</span>, <span class="kw">FUN</span><span class="kw">=</span><span class="st">"sum"</span>)
<span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span>(<span class="no">abund</span>) <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"year"</span>, <span class="st">"model"</span>, <span class="st">"abundance"</span>)

<span class="co"># Add true abundance</span>
<span class="no">x</span> <span class="kw">&lt;-</span> <span class="no">sim1</span>$<span class="no">grid</span>
<span class="kw">if</span> (<span class="no">sim1</span>$<span class="no">meta</span>$<span class="no">abund_enviro</span> <span class="kw">==</span> <span class="st">"poisson"</span>) <span class="no">x</span>$<span class="no">abundance</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span>(<span class="no">x</span>$<span class="no">abundance</span>)
<span class="no">tmp</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/aggregate.html">aggregate</a></span>(<span class="no">abundance</span>~<span class="no">year</span>, <span class="no">x</span>, <span class="kw">FUN</span><span class="kw">=</span><span class="st">"sum"</span>)
<span class="no">tmp</span>$<span class="no">model</span> <span class="kw">&lt;-</span> <span class="st">"true"</span>
<span class="no">tmp</span> <span class="kw">&lt;-</span> <span class="no">tmp</span>[,<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"year"</span>, <span class="st">"model"</span>, <span class="st">"abundance"</span>)]

<span class="no">abund</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span>(<span class="no">abund</span>, <span class="no">tmp</span>)</pre></body></html></div>
<p>Next we plot</p>
<div class="sourceCode" id="cb14"><html><body><pre class="r"><span class="no">p</span> <span class="kw">&lt;-</span> <span class="fu">ggplot</span>(<span class="no">abund</span>, <span class="fu">aes</span>(<span class="kw">x</span><span class="kw">=</span><span class="no">year</span>, <span class="kw">y</span><span class="kw">=</span><span class="no">abundance</span>, <span class="kw">color</span><span class="kw">=</span><span class="no">model</span>)) +
  <span class="fu">geom_line</span>() +
  <span class="fu">ggtitle</span>(<span class="st">"Comparison of models"</span>) +
  <span class="fu">geom_vline</span>(<span class="kw">xintercept</span><span class="kw">=</span><span class="fl">2020</span>) +
  <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="kw">x</span><span class="kw">=</span><span class="fl">2020</span>, <span class="kw">y</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span>(<span class="no">abund</span>$<span class="no">abundance</span>), <span class="kw">label</span><span class="kw">=</span><span class="st">"  forecast"</span>, <span class="kw">hjust</span><span class="kw">=</span><span class="fl">0</span>) +
  <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="kw">x</span><span class="kw">=</span><span class="fl">2020</span>, <span class="kw">y</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span>(<span class="no">abund</span>$<span class="no">abundance</span>), <span class="kw">label</span><span class="kw">=</span><span class="st">"hindcast  "</span>, <span class="kw">hjust</span><span class="kw">=</span><span class="fl">1</span>)
<span class="no">p</span></pre></body></html></div>
<p><img src="Plotting_files/figure-html/unnamed-chunk-9-1.png" width="576"></p>
</div>
<div id="calculate-and-plot-centre-of-gravity" class="section level2">
<h2 class="hasAnchor">
<a href="#calculate-and-plot-centre-of-gravity" class="anchor"></a>Calculate and plot centre of gravity</h2>
<p>The function <code><a href="../reference/plot_cog.html">plot_cog()</a></code> will plot the center of gravity of OMs (from simulations) and fitted models. If you pass in a fitted object (SDM), <code><a href="../reference/plot_cog.html">plot_cog()</a></code> will run <code><a href="https://rdrr.io/r/stats/predict.html">predict()</a></code> on that object or you can pass in a predict object (POM) returned by <code><a href="https://rdrr.io/r/stats/predict.html">predict()</a></code> if you already have that. The latter will be faster since the plotting doesn’t need to rerun <code><a href="https://rdrr.io/r/stats/predict.html">predict()</a></code>. You can pass in any combination of OMs, SDMs, and POMs.</p>
<div class="sourceCode" id="cb15"><html><body><pre class="r"><span class="fu"><a href="../reference/plot_cog.html">plot_cog</a></span>(<span class="no">sim1</span>, <span class="no">pred.gam</span>, <span class="no">pred.mlp</span>, <span class="no">pred.brt</span>)</pre></body></html></div>
<p><img src="Plotting_files/figure-html/unnamed-chunk-10-1.png" width="576"></p>
<div class="sourceCode" id="cb16"><html><body><pre class="r"># You can also pass in SDMs
# plot_cog(sim1, gam.fit, mlp.fit, brt.fit)</pre></body></html></div>
<p>Here is how to compute these COG plots without <code>plot_cog</code>. First we create a data frame of the COG predictions and true abundance.</p>
<div class="sourceCode" id="cb17"><html><body><pre class="r"><span class="co"># First compute the true cog</span>
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">dplyr</span>)
<span class="no">cog_lat</span> <span class="kw">&lt;-</span> <span class="no">x</span> <span class="kw">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span>(<span class="no">year</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize</a></span>(<span class="kw">cog</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/stats/weighted.mean.html">weighted.mean</a></span>(<span class="kw">x</span><span class="kw">=</span><span class="no">lat</span>, <span class="kw">w</span><span class="kw">=</span><span class="no">abundance</span>))
<span class="no">cog_lat</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span>(<span class="kw">model</span><span class="kw">=</span><span class="st">"true"</span>, <span class="no">cog_lat</span>, <span class="kw">stringsAsFactors</span> <span class="kw">=</span> <span class="fl">FALSE</span>)

<span class="co"># Now add the model cogs</span>
<span class="no">tmp</span> <span class="kw">&lt;-</span> <span class="no">pred.all</span> <span class="kw">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span>(<span class="no">model</span>, <span class="no">year</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize</a></span>(<span class="kw">cog</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/stats/weighted.mean.html">weighted.mean</a></span>(<span class="kw">x</span><span class="kw">=</span><span class="no">lat</span>, <span class="kw">w</span><span class="kw">=</span><span class="no">pred</span>))

<span class="co"># dplyr uses tibbles and they return a matrix when you use rbind().</span>
<span class="co"># so use </span>
<span class="no">cog_lat</span> <span class="kw">&lt;-</span> <span class="kw pkg">dplyr</span><span class="kw ns">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind.html">bind_rows</a></span>(<span class="no">cog_lat</span>, <span class="no">tmp</span>)</pre></body></html></div>
<p><code>cog_lat</code> is now a data frame with the center of gravity and a model column for the model (or true).</p>
<div class="sourceCode" id="cb18"><html><body><pre class="r"><span class="no">p</span> <span class="kw">&lt;-</span> <span class="fu">ggplot</span>(<span class="no">cog_lat</span>, <span class="fu">aes</span>(<span class="kw">x</span><span class="kw">=</span><span class="no">year</span>, <span class="kw">y</span><span class="kw">=</span><span class="no">cog</span>, <span class="kw">color</span><span class="kw">=</span><span class="no">model</span>)) +
  <span class="fu">geom_line</span>() +
  <span class="fu">ggtitle</span>(<span class="st">"Comparison of lnorm_low models"</span>) +
  <span class="fu">ylab</span>(<span class="st">"Centre of Gravity (deg lat)"</span>) +
  <span class="fu">geom_vline</span>(<span class="kw">xintercept</span><span class="kw">=</span><span class="fl">2020</span>) +
  <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="kw">x</span><span class="kw">=</span><span class="fl">2020</span>, <span class="kw">y</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span>(<span class="no">cog_lat</span>$<span class="no">cog</span>), <span class="kw">label</span><span class="kw">=</span><span class="st">"  forecast"</span>, <span class="kw">hjust</span><span class="kw">=</span><span class="fl">0</span>) +
  <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="kw">x</span><span class="kw">=</span><span class="fl">2020</span>, <span class="kw">y</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span>(<span class="no">cog_lat</span>$<span class="no">cog</span>), <span class="kw">label</span><span class="kw">=</span><span class="st">"hindcast  "</span>, <span class="kw">hjust</span><span class="kw">=</span><span class="fl">1</span>)

<span class="no">p</span></pre></body></html></div>
<p><img src="Plotting_files/figure-html/unnamed-chunk-12-1.png" width="576"></p>
</div>
<div id="plot-average-presence" class="section level2">
<h2 class="hasAnchor">
<a href="#plot-average-presence" class="anchor"></a>Plot average presence</h2>
<p>The function <code><a href="../reference/plot_pres.html">plot_pres()</a></code> will plot average presence by year. This function is similar to <code><a href="../reference/plot_abund.html">plot_abund()</a></code>.</p>
<div class="sourceCode" id="cb19"><html><body><pre class="r"><span class="fu"><a href="../reference/plot_pres.html">plot_pres</a></span>(<span class="no">sim1</span>, <span class="no">pred.gam</span>, <span class="no">pred.mlp</span>, <span class="no">pred.brt</span>)</pre></body></html></div>
<p><img src="Plotting_files/figure-html/unnamed-chunk-13-1.png" width="576"></p>
<div class="sourceCode" id="cb20"><html><body><pre class="r"># You can also pass in SDMs
# plot_cog(sim1, gam.fit, mlp.fit, brt.fit)</pre></body></html></div>
</div>
<div id="plot-surface-predictions" class="section level2">
<h2 class="hasAnchor">
<a href="#plot-surface-predictions" class="anchor"></a>Plot Surface Predictions</h2>
<p>These are point predictions for individual cells. Since there are only 400 points per year for this simulation, it will look sparse if we only plot one year. We will plot 20 years, 2021 to 2040. Note <code><a href="../reference/plot_grid.html">plot_grid()</a></code> works with any combination of OM, SDM and POM objects, but if SDMs are included then the first argument must be the OM for which predictions will be made from the SDM.</p>
<div class="sourceCode" id="cb21"><html><body><pre class="r"><span class="fu"><a href="../reference/plot_grid.html">plot_grid</a></span>(<span class="no">sim1</span>, <span class="kw">year</span><span class="kw">=</span><span class="fl">2021</span>:<span class="fl">2040</span>, <span class="no">pred.gam</span>, <span class="no">pred.mlp</span>, <span class="no">pred.brt</span>)</pre></body></html></div>
<p><img src="Plotting_files/figure-html/unnamed-chunk-14-1.png" width="576"></p>
<div class="sourceCode" id="cb22"><html><body><pre class="r"># You can also pass in SDMs but the predictions will be computed (slow)
# plot_grid(sim1, year=2021:2040, gam.fit, mlp.fit, brt.fit)</pre></body></html></div>
<p>Here is how you could make the plot directly.</p>
<div class="sourceCode" id="cb23"><html><body><pre class="r"><span class="co">#Future</span>
<span class="no">uscale</span> <span class="kw">&lt;-</span> <span class="fl">9.5</span>
<span class="no">Y</span> <span class="kw">&lt;-</span> <span class="fl">2021</span>:<span class="fl">2040</span>
<span class="no">x</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span>(<span class="no">sim1</span>$<span class="no">grid</span>, <span class="no">year</span><span class="kw">%in%</span><span class="no">Y</span>)
<span class="co">#Truth</span>
<span class="no">p1</span> <span class="kw">&lt;-</span> <span class="fu">ggplot</span>(<span class="no">x</span>, <span class="fu">aes</span>(<span class="kw">x</span><span class="kw">=</span><span class="no">lon</span>, <span class="kw">y</span><span class="kw">=</span><span class="no">lat</span>))+
  <span class="fu">geom_tile</span>(<span class="fu">aes</span>(<span class="kw">fill</span><span class="kw">=</span><span class="no">abundance</span>)) +
  <span class="fu">theme_classic</span>() +
  <span class="fu">ggtitle</span>(<span class="st">"Truth"</span>)+
  <span class="fu">labs</span>(<span class="kw">y</span><span class="kw">=</span><span class="st">"Latitude"</span>) +
  <span class="fu">scale_x_continuous</span>(<span class="kw">expand</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0</span>, <span class="fl">0</span>)) +
  <span class="fu">scale_y_continuous</span>( <span class="kw">expand</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0</span>, <span class="fl">0</span>)) +
  <span class="fu">theme</span>(<span class="kw">legend.title</span><span class="kw">=</span><span class="fu">element_blank</span>(),
        <span class="kw">plot.title</span> <span class="kw">=</span> <span class="fu">element_text</span>(<span class="kw">hjust</span><span class="kw">=</span><span class="fl">0.5</span>),
        <span class="kw">panel.border</span> <span class="kw">=</span> <span class="fu">element_rect</span>(<span class="kw">colour</span> <span class="kw">=</span> <span class="st">"black"</span>, <span class="kw">fill</span><span class="kw">=</span><span class="fl">NA</span>, <span class="kw">size</span><span class="kw">=</span><span class="fl">1</span>)) +
  <span class="kw pkg">viridis</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/viridis/man/scale_viridis.html">scale_fill_viridis</a></span>(<span class="kw">limits</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0</span>, <span class="no">uscale</span>))

<span class="co">#Gam</span>
<span class="no">x</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span>(<span class="no">pred.all</span>, <span class="no">year</span><span class="kw">%in%</span><span class="no">Y</span> <span class="kw">&amp;</span> <span class="no">model</span><span class="kw">==</span><span class="st">"gam"</span>)
<span class="no">p2</span> <span class="kw">&lt;-</span> <span class="fu">ggplot</span>(<span class="no">x</span>, <span class="fu">aes</span>(<span class="no">lon</span>,<span class="no">lat</span>))+
  <span class="fu">geom_tile</span>(<span class="fu">aes</span>(<span class="kw">fill</span><span class="kw">=</span><span class="no">pred</span>)) +
  <span class="fu">theme_classic</span>() +
  <span class="fu">ggtitle</span>(<span class="st">"GAM"</span>)+
  <span class="fu">labs</span>(<span class="kw">y</span><span class="kw">=</span><span class="st">"Latitude"</span>) +
  <span class="fu">scale_x_continuous</span>(<span class="kw">expand</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0</span>, <span class="fl">0</span>)) +
  <span class="fu">scale_y_continuous</span>( <span class="kw">expand</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0</span>, <span class="fl">0</span>)) +
  <span class="fu">theme</span>(<span class="kw">legend.title</span><span class="kw">=</span><span class="fu">element_blank</span>(),
        <span class="kw">plot.title</span> <span class="kw">=</span> <span class="fu">element_text</span>(<span class="kw">hjust</span><span class="kw">=</span><span class="fl">0.5</span>),
        <span class="kw">panel.border</span> <span class="kw">=</span> <span class="fu">element_rect</span>(<span class="kw">colour</span> <span class="kw">=</span> <span class="st">"black"</span>, <span class="kw">fill</span><span class="kw">=</span><span class="fl">NA</span>, <span class="kw">size</span><span class="kw">=</span><span class="fl">1</span>)) +
  <span class="kw pkg">viridis</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/viridis/man/scale_viridis.html">scale_fill_viridis</a></span>(<span class="kw">limits</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0</span>, <span class="no">uscale</span>))

<span class="co">#BRT</span>
<span class="no">x</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span>(<span class="no">pred.all</span>, <span class="no">year</span><span class="kw">%in%</span><span class="no">Y</span> <span class="kw">&amp;</span> <span class="no">model</span><span class="kw">==</span><span class="st">"brt"</span>)
<span class="no">p3</span> <span class="kw">&lt;-</span> <span class="fu">ggplot</span>(<span class="no">x</span>, <span class="fu">aes</span>(<span class="no">lon</span>,<span class="no">lat</span>))+
  <span class="fu">geom_tile</span>(<span class="fu">aes</span>(<span class="kw">fill</span><span class="kw">=</span><span class="no">pred</span>)) +
  <span class="fu">theme_classic</span>() +
  <span class="fu">ggtitle</span>(<span class="st">"BRT"</span>)+
  <span class="fu">labs</span>(<span class="kw">y</span><span class="kw">=</span><span class="st">"Latitude"</span>) +
  <span class="fu">scale_x_continuous</span>(<span class="kw">expand</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0</span>, <span class="fl">0</span>)) +
  <span class="fu">scale_y_continuous</span>( <span class="kw">expand</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0</span>, <span class="fl">0</span>)) +
  <span class="fu">theme</span>(<span class="kw">legend.title</span><span class="kw">=</span><span class="fu">element_blank</span>(),
        <span class="kw">plot.title</span> <span class="kw">=</span> <span class="fu">element_text</span>(<span class="kw">hjust</span><span class="kw">=</span><span class="fl">0.5</span>),
        <span class="kw">panel.border</span> <span class="kw">=</span> <span class="fu">element_rect</span>(<span class="kw">colour</span> <span class="kw">=</span> <span class="st">"black"</span>, <span class="kw">fill</span><span class="kw">=</span><span class="fl">NA</span>, <span class="kw">size</span><span class="kw">=</span><span class="fl">1</span>)) +
  <span class="kw pkg">viridis</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/viridis/man/scale_viridis.html">scale_fill_viridis</a></span>(<span class="kw">limits</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0</span>, <span class="no">uscale</span>))

<span class="co">#Gam</span>
<span class="no">x</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span>(<span class="no">pred.all</span>, <span class="no">year</span><span class="kw">%in%</span><span class="no">Y</span> <span class="kw">&amp;</span> <span class="no">model</span><span class="kw">==</span><span class="st">"mlp"</span>)
<span class="no">p4</span> <span class="kw">&lt;-</span> <span class="fu">ggplot</span>(<span class="no">x</span>, <span class="fu">aes</span>(<span class="no">lon</span>,<span class="no">lat</span>))+
  <span class="fu">geom_tile</span>(<span class="fu">aes</span>(<span class="kw">fill</span><span class="kw">=</span><span class="no">pred</span>)) +
  <span class="fu">theme_classic</span>() +
  <span class="fu">ggtitle</span>(<span class="st">"MLP"</span>)+
  <span class="fu">labs</span>(<span class="kw">y</span><span class="kw">=</span><span class="st">"Latitude"</span>) +
  <span class="fu">scale_x_continuous</span>(<span class="kw">expand</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0</span>, <span class="fl">0</span>)) +
  <span class="fu">scale_y_continuous</span>( <span class="kw">expand</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0</span>, <span class="fl">0</span>)) +
  <span class="fu">theme</span>(<span class="kw">legend.title</span><span class="kw">=</span><span class="fu">element_blank</span>(),
        <span class="kw">plot.title</span> <span class="kw">=</span> <span class="fu">element_text</span>(<span class="kw">hjust</span><span class="kw">=</span><span class="fl">0.5</span>),
        <span class="kw">panel.border</span> <span class="kw">=</span> <span class="fu">element_rect</span>(<span class="kw">colour</span> <span class="kw">=</span> <span class="st">"black"</span>, <span class="kw">fill</span><span class="kw">=</span><span class="fl">NA</span>, <span class="kw">size</span><span class="kw">=</span><span class="fl">1</span>)) +
  <span class="kw pkg">viridis</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/viridis/man/scale_viridis.html">scale_fill_viridis</a></span>(<span class="kw">limits</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0</span>, <span class="no">uscale</span>))

<span class="kw pkg">gridExtra</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/gridExtra/man/arrangeGrob.html">grid.arrange</a></span>(<span class="no">p1</span>, <span class="no">p2</span>, <span class="no">p3</span>, <span class="no">p4</span>, <span class="kw">nrow</span><span class="kw">=</span><span class="fl">2</span>)</pre></body></html></div>
<p><img src="Plotting_files/figure-html/surf_pred-1.png" width="576"></p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Stephanie Brodie, James Smith, Eli Holmes.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.0.9000.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
