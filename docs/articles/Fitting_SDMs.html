<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Fitting SDMs • WRAP</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/cosmo/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Fitting SDMs">
<meta property="og:description" content="WRAP">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">WRAP</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.5</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../articles/index.html">Vignettes</a>
</li>
<li>
  <a href="../reference/index.html">Functions</a>
</li>
<li>
  <a href="../articles/pkgdown/Package.html">Package Building</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/eeholmes/WRAP">
    <span class="fa fa-github"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Fitting SDMs</h1>
            
            <h4 class="date">2020-05-25</h4>
      
      
      <div class="hidden name"><code>Fitting_SDMs.Rmd</code></div>

    </div>

    
    
<p>This vignette shows how to fit SDMs with the <strong>WRAP</strong> package and make some basic plots. See the plotting vignette for more details on the plotting functions. The fitting functions in <strong>WRAP</strong> are</p>
<ul>
<li><code><a href="../reference/gam_sdm.html">gam_sdm()</a></code></li>
<li><code><a href="../reference/brt_sdm.html">brt_sdm()</a></code></li>
<li><code><a href="../reference/mlp_sdm.html">mlp_sdm()</a></code></li>
</ul>
<p>Type <code><a href="../reference/gam_sdm.html">?gam_sdm</a></code>, etc, to learn about the arguments for the function.</p>
<p><strong>WRAP</strong> also includes some plotting functions</p>
<ul>
<li>
<code><a href="../reference/plot_cog.html">plot_cog()</a></code> Center of gravity</li>
<li>
<code><a href="../reference/plot_abund.html">plot_abund()</a></code> Average abundance</li>
</ul>
<div class="sourceCode" id="cb1"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">WRAP</span>)</pre></body></html></div>
<div id="simulate-data" class="section level1">
<h1 class="hasAnchor">
<a href="#simulate-data" class="anchor"></a>Simulate data</h1>
<p>There are three simulation functions that can be used. <code><a href="../reference/SimulateWorld_ROMS.html">SimulateWorld_ROMS()</a></code> which uses ROMS for the environmental fields, <code>SimulateWorld_ROMS_TrophicInteractins()</code> which uses ROMS and trophic interactions, and <code><a href="../reference/SimulateWorld.html">SimulateWorld()</a></code> which simulates a temperature field.</p>
<p>We will use <code><a href="../reference/SimulateWorld.html">SimulateWorld()</a></code> for this example. Type <code><a href="../reference/SimulateWorld.html">?SimulateWorld</a></code> as console to learn more about this function.</p>
<p>Parameters for the function are</p>
<ul>
<li>
<code>abund_enviro</code> can be “lnorm_low” (SB); “lnorm_high” (EW); or “poisson” (JS).</li>
<li>
<code>PA_shape</code> can be “logistic” (SB); “logistic_prev”,“linear” (JS)</li>
<li>
<code>temp_spatial</code> can be “simple” (SB); or “matern” (EW)</li>
<li>
<code>temp_diff</code> is only for the simulated temperature. It specifies min and max temps at year 1 and year 100 (e.g. temp_diff=c(1,3,5,7) means year 1 varies from 1-3C and year 100 from 5-7C).</li>
<li>
<code>dir</code> is the directory where ROMS data is stored. The ROMS functions are looking for a directory called <code>gfdl</code>. The default assumption is that this is in your working directory in a folder called <code>Rasters_2d_monthly</code>.</li>
</ul>
<p>We will set the parameters to the following for our simulated abundances and presence/absence grid.</p>
<div class="sourceCode" id="cb2"><html><body><pre class="r"><span class="no">abund_enviro</span> <span class="kw">&lt;-</span> <span class="st">"lnorm_low"</span>
<span class="no">PA_shape</span> <span class="kw">&lt;-</span> <span class="st">"logistic"</span>
<span class="no">temp_spatial</span> <span class="kw">&lt;-</span> <span class="st">"matern"</span>
<span class="no">temp_diff</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">1</span>,<span class="fl">4</span>,<span class="fl">3</span>,<span class="fl">7</span>)</pre></body></html></div>
<p>Simulate species abundances from the simulated temperature fields.</p>
<div class="sourceCode" id="cb3"><html><body><pre class="r"><span class="no">sim1</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/SimulateWorld.html">SimulateWorld</a></span>(<span class="kw">temp_diff</span> <span class="kw">=</span> <span class="no">temp_diff</span>,
                      <span class="kw">temp_spatial</span> <span class="kw">=</span> <span class="no">temp_spatial</span>,
                      <span class="kw">PA_shape</span> <span class="kw">=</span> <span class="no">PA_shape</span>,
                      <span class="kw">abund_enviro</span> <span class="kw">=</span> <span class="no">abund_enviro</span>,
                      <span class="kw">n.year</span><span class="kw">=</span><span class="fl">40</span>, <span class="kw">start.year</span><span class="kw">=</span><span class="fl">2015</span>)</pre></body></html></div>
<p>Printing the output will show you basic information about the simulation. This information is in <code>sim1$meta</code>.</p>
<div class="sourceCode" id="cb4"><html><body><pre class="r"><span class="no">sim1</span>
<span class="co">## Simulated species abundance and suitability from WRAP version 1.5 and function SimulateWorld</span>
<span class="co">##    covariates: temp</span>
<span class="co">##    grid.dimensions: 20, 20, 400 (nrow, ncol, cells) </span>
<span class="co">##    grid.resolution 1, 1 (x, y) </span>
<span class="co">##    grid.extent 1, 20, 1, 20 (xmin, xmax, ymin, ymax) </span>
<span class="co">##    grid.units: not applicable</span>
<span class="co">##    time.extent: 2016 to 2055 year</span></pre></body></html></div>
<div id="save-data" class="section level2">
<h2 class="hasAnchor">
<a href="#save-data" class="anchor"></a>Save data</h2>
<p>Since simulations take a long time to run, you may want to create a directory in your working directory for the simulations and save them there. Then you can reload the simulations instead of re-running.</p>
<p>Create a directory for the simulations:</p>
<div class="sourceCode" id="cb5"><html><body><pre class="r"><span class="kw">if</span>(!<span class="fu"><a href="https://rdrr.io/r/base/files2.html">dir.exists</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span>(<span class="kw pkg">here</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/here/man/here.html">here</a></span>(), <span class="st">'Sim1'</span>)))
  <span class="fu"><a href="https://rdrr.io/r/base/files2.html">dir.create</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span>(<span class="kw pkg">here</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/here/man/here.html">here</a></span>(), <span class="st">'Sim1'</span>))</pre></body></html></div>
<p>Save the simulation.</p>
<div class="sourceCode" id="cb6"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">saveRDS</a></span>(<span class="no">sim1</span>, <span class="kw">file</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span>(<span class="kw pkg">here</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/here/man/here.html">here</a></span>(), <span class="st">"Sim1"</span>, <span class="st">"Sim1.rds"</span>))</pre></body></html></div>
</div>
<div id="plot-the-simulated-data" class="section level2">
<h2 class="hasAnchor">
<a href="#plot-the-simulated-data" class="anchor"></a>Plot the simulated data</h2>
<div class="sourceCode" id="cb7"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(<span class="no">sim1</span>, <span class="kw">start.forecast.year</span><span class="kw">=</span><span class="fl">2020</span>)</pre></body></html></div>
<p><img src="Fitting_SDMs_files/figure-html/plot-sim-1.png" width="576"></p>
</div>
</div>
<div id="fit-sdms-to-the-simulated-grid" class="section level1">
<h1 class="hasAnchor">
<a href="#fit-sdms-to-the-simulated-grid" class="anchor"></a>Fit SDMs to the simulated grid</h1>
<p>We will fit GAM, BRT and MLP SDM models to the simulated grids. The fit function will fit the correct model (lognormal or poisson) based on the value of <code>abund_enviro</code>. If you want to restrict the smoothing, you can pass in <code>k</code> to the GAM function. The default fitting period is years prior to 2021 (<code>start.forecast.year=2021</code>). The fitting function will return both the presence and abundance models.</p>
<div class="sourceCode" id="cb8"><html><body><pre class="r"><span class="no">gam.fit</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/gam_sdm.html">gam_sdm</a></span>(<span class="no">sim1</span>, <span class="kw">covariates</span><span class="kw">=</span><span class="st">"temp"</span>)
<span class="no">gam.p</span> <span class="kw">&lt;-</span> <span class="no">gam.fit</span>$<span class="no">presence</span>
<span class="no">gam.a</span> <span class="kw">&lt;-</span> <span class="no">gam.fit</span>$<span class="no">abundance</span>

<span class="no">brt.fit</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/brt_sdm.html">brt_sdm</a></span>(<span class="no">sim1</span>, <span class="kw">covariates</span><span class="kw">=</span><span class="st">"temp"</span>)
<span class="no">brt.p</span> <span class="kw">&lt;-</span> <span class="no">brt.fit</span>$<span class="no">presence</span>
<span class="no">brt.a</span> <span class="kw">&lt;-</span> <span class="no">brt.fit</span>$<span class="no">abundance</span>

<span class="no">mlp.fit</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/mlp_sdm.html">mlp_sdm</a></span>(<span class="no">sim1</span>, <span class="kw">covariates</span><span class="kw">=</span><span class="st">"temp"</span>)
<span class="no">mlp.p</span> <span class="kw">&lt;-</span> <span class="no">mlp.fit</span>$<span class="no">presence</span>
<span class="no">mlp.a</span> <span class="kw">&lt;-</span> <span class="no">mlp.fit</span>$<span class="no">abundance</span></pre></body></html></div>
</div>
<div id="create-predictions-for-a-new-covariate-range" class="section level1">
<h1 class="hasAnchor">
<a href="#create-predictions-for-a-new-covariate-range" class="anchor"></a>Create Predictions for a new covariate range</h1>
<p>Now plot the comparison of the models for temperaturs 0 to 7C.</p>
<p>First we need to set up the temperatures used for prediction.</p>
<div class="sourceCode" id="cb9"><html><body><pre class="r"><span class="no">new_dat</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span>(<span class="kw">temp</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span>(<span class="fl">0</span>,<span class="fl">7</span>,<span class="kw">length</span><span class="kw">=</span><span class="fl">100</span>))</pre></body></html></div>
<p>The <code><a href="../reference/predict.OM.html">predict.OM()</a></code> function will compute the predicted presence, abundance and expected abundance (pred presence x pred abundance). You can (optionally) pass in a fitted model. If you do not, the predict function will fit a SDM based on the <code>model</code> argument (e.g. <code><a href="https://rdrr.io/r/stats/predict.html">predict(sim1, model="gam")</a></code>). We will pass in the fitted SDMs to speed up the predictions. This predict function for a OM object returns a data frame with pred.p, pred.a, pred and CIs added (pred is expected abundance = pred<span class="math inline">\(pred.p*exp(pred\)</span>pred.a)). A column pred.type indicates the type of prediction: hindcast, forecast, or newdata.</p>
<div class="sourceCode" id="cb10"><html><body><pre class="r"><span class="no">pred.gam</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span>(<span class="no">sim1</span>, <span class="kw">sdm</span><span class="kw">=</span><span class="no">gam.fit</span>, <span class="kw">newdata</span><span class="kw">=</span><span class="no">new_dat</span>)
<span class="no">pred.brt</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span>(<span class="no">sim1</span>, <span class="kw">sdm</span><span class="kw">=</span><span class="no">brt.fit</span>, <span class="kw">newdata</span><span class="kw">=</span><span class="no">new_dat</span>)
<span class="no">pred.mlp</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span>(<span class="no">sim1</span>, <span class="kw">sdm</span><span class="kw">=</span><span class="no">mlp.fit</span>, <span class="kw">newdata</span><span class="kw">=</span><span class="no">new_dat</span>)</pre></body></html></div>
<div id="plot-predictions" class="section level2">
<h2 class="hasAnchor">
<a href="#plot-predictions" class="anchor"></a>Plot Predictions</h2>
<div class="sourceCode" id="cb11"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span>(<span class="kw">mfrow</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">2</span>,<span class="fl">2</span>), <span class="kw">mar</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">3</span>,<span class="fl">4</span>,<span class="fl">4</span>,<span class="fl">2</span>))
<span class="no">ylim2</span> <span class="kw">&lt;-</span> <span class="fl">1.05</span>*<span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span>(<span class="no">pred.gam</span>$<span class="no">pred</span>, <span class="no">pred.brt</span>$<span class="no">pred</span>, <span class="no">pred.mlp</span>$<span class="no">pred</span>)

<span class="co">#actual TPC</span>
<span class="no">xx</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span>(<span class="fl">0</span>, <span class="fl">7</span>, <span class="kw">length</span><span class="kw">=</span><span class="fl">100</span>)
<span class="co">#yy must match response function in SimulateWorld function (sim1$meta$response.curve$temp)</span>
<span class="no">yy</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">dnorm</a></span>(<span class="no">xx</span>, <span class="kw">mean</span><span class="kw">=</span><span class="fl">4</span>, <span class="kw">sd</span><span class="kw">=</span><span class="fl">1</span>)
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(<span class="no">xx</span>, <span class="no">yy</span>, <span class="kw">type</span><span class="kw">=</span><span class="st">"l"</span>, <span class="kw">lty</span><span class="kw">=</span><span class="fl">2</span>, <span class="kw">main</span><span class="kw">=</span><span class="st">"Actual TPC"</span>, <span class="kw">col</span><span class="kw">=</span><span class="st">"red"</span>, <span class="kw">xlim</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0</span>,<span class="fl">8</span>), <span class="kw">ylab</span><span class="kw">=</span><span class="st">"suitability"</span>, <span class="kw">xlab</span><span class="kw">=</span><span class="st">"Temp"</span>)
<span class="no">xlim</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span>(<span class="fl">100</span>*(<span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span>(<span class="no">new_dat</span>$<span class="no">temp</span>)/<span class="fl">7</span>))
<span class="fu"><a href="https://rdrr.io/r/graphics/lines.html">lines</a></span>(<span class="no">xx</span>[<span class="fl">1</span>:<span class="no">xlim</span>], <span class="no">yy</span>[<span class="fl">1</span>:<span class="no">xlim</span>], <span class="kw">lwd</span><span class="kw">=</span><span class="fl">2</span>)

<span class="co">#gam</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(<span class="no">new_dat</span>$<span class="no">temp</span>, <span class="no">pred.gam</span>$<span class="no">pred</span>, <span class="kw">type</span><span class="kw">=</span><span class="st">"l"</span>,
     <span class="kw">main</span><span class="kw">=</span><span class="st">"lnorm_low GAM"</span>, <span class="kw">xlim</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0</span>,<span class="fl">8</span>), <span class="kw">col</span><span class="kw">=</span><span class="st">"red"</span>, <span class="kw">lty</span><span class="kw">=</span><span class="fl">2</span>, <span class="kw">ylim</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0</span>,<span class="no">ylim2</span>), <span class="kw">ylab</span><span class="kw">=</span><span class="st">"Abundance"</span>, <span class="kw">xlab</span><span class="kw">=</span><span class="st">"Temp"</span>)
<span class="fu"><a href="https://rdrr.io/r/graphics/lines.html">lines</a></span>(<span class="no">new_dat</span>$<span class="no">temp</span>, <span class="no">pred.gam</span>$<span class="no">pred</span>, <span class="kw">lwd</span><span class="kw">=</span><span class="fl">2</span>)

<span class="co">#brt</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(<span class="no">new_dat</span>$<span class="no">temp</span>, <span class="no">pred.brt</span>$<span class="no">pred</span>, <span class="kw">type</span><span class="kw">=</span><span class="st">"l"</span>,
     <span class="kw">main</span><span class="kw">=</span><span class="st">"lnorm_low BRT"</span>, <span class="kw">xlim</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0</span>,<span class="fl">8</span>), <span class="kw">col</span><span class="kw">=</span><span class="st">"red"</span>, <span class="kw">lty</span><span class="kw">=</span><span class="fl">2</span>, <span class="kw">ylim</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0</span>,<span class="no">ylim2</span>), <span class="kw">ylab</span><span class="kw">=</span><span class="st">"Abundance"</span>, <span class="kw">xlab</span><span class="kw">=</span><span class="st">"Temp"</span>)
<span class="fu"><a href="https://rdrr.io/r/graphics/lines.html">lines</a></span>(<span class="no">new_dat</span>$<span class="no">temp</span>, <span class="no">pred.brt</span>$<span class="no">pred</span>, <span class="kw">lwd</span><span class="kw">=</span><span class="fl">2</span>)

<span class="co">#MLP</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(<span class="no">new_dat</span>$<span class="no">temp</span>, <span class="no">pred.mlp</span>$<span class="no">pred</span>, <span class="kw">type</span><span class="kw">=</span><span class="st">"l"</span>,
     <span class="kw">main</span><span class="kw">=</span><span class="st">"lnorm_low MLP"</span>, <span class="kw">xlim</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0</span>,<span class="fl">8</span>), <span class="kw">col</span><span class="kw">=</span><span class="st">"red"</span>, <span class="kw">lty</span><span class="kw">=</span><span class="fl">2</span>, <span class="kw">ylim</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0</span>,<span class="no">ylim2</span>), <span class="kw">ylab</span><span class="kw">=</span><span class="st">"Abundance"</span>, <span class="kw">xlab</span><span class="kw">=</span><span class="st">"Temp"</span>)
<span class="fu"><a href="https://rdrr.io/r/graphics/lines.html">lines</a></span>(<span class="no">new_dat</span>$<span class="no">temp</span>, <span class="no">pred.mlp</span>$<span class="no">pred</span>, <span class="kw">lwd</span><span class="kw">=</span><span class="fl">2</span>)</pre></body></html></div>
<p><img src="Fitting_SDMs_files/figure-html/plot-pred-1.png" width="576"></p>
<div class="sourceCode" id="cb12"><html><body><pre class="r">
<span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span>(<span class="kw">mfrow</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">1</span>,<span class="fl">1</span>))</pre></body></html></div>
</div>
</div>
<div id="make-predictions-for-the-years-and-values-in-the-simulation" class="section level1">
<h1 class="hasAnchor">
<a href="#make-predictions-for-the-years-and-values-in-the-simulation" class="anchor"></a>Make predictions for the years and values in the simulation</h1>
<p>If <code>newdata</code> is left off, <code><a href="https://rdrr.io/r/stats/predict.html">predict(sim)</a></code> where <code>sim</code> is the output from one of the simulation functions (operating model) will return a data frame with a hindcast for years before start.forecast.year and a forecast after that. See <code><a href="../reference/predict.OM.html">?predict.OM</a></code> for other arguments that this function takes.</p>
<p>You can pass in a previously fitted SDM to speed up the function as we did before. But you can leave these off and <code>predict</code> will fit the SDM based on the value in <code>sim$meta$abund_enviro</code>. Specify the SDM model with argument <code>model</code>.</p>
<div class="sourceCode" id="cb13"><html><body><pre class="r"><span class="no">pred.gam2</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span>(<span class="no">sim1</span>, <span class="kw">model</span><span class="kw">=</span><span class="st">"gam"</span>)
<span class="no">pred.brt2</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span>(<span class="no">sim1</span>, <span class="kw">model</span><span class="kw">=</span><span class="st">"brt"</span>)
<span class="no">pred.mlp2</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span>(<span class="no">sim1</span>, <span class="kw">model</span><span class="kw">=</span><span class="st">"mlp"</span>)</pre></body></html></div>
<p>This will re-estimate the fitted models. This won’t make a difference for gam and brt, but will for the mlp model with the default settings since that is a stochastic fit. We can pass in our fits so that we use a known model.</p>
<div class="sourceCode" id="cb14"><html><body><pre class="r"><span class="no">pred.gam2</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span>(<span class="no">sim1</span>, <span class="kw">sdm</span><span class="kw">=</span><span class="no">gam.fit</span>)
<span class="no">pred.brt2</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span>(<span class="no">sim1</span>, <span class="kw">sdm</span><span class="kw">=</span><span class="no">brt.fit</span>)
<span class="no">pred.mlp2</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span>(<span class="no">sim1</span>, <span class="kw">sdm</span><span class="kw">=</span><span class="no">mlp.fit</span>)</pre></body></html></div>
<p>Assemble the predictions into one data frame.</p>
<div class="sourceCode" id="cb15"><html><body><pre class="r"><span class="no">nr</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span>(<span class="no">pred.gam2</span>)
<span class="no">pred.all</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span>(<span class="no">pred.gam2</span>, <span class="no">pred.brt2</span>, <span class="no">pred.mlp2</span>)
<span class="no">pred.all</span>$<span class="no">model</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="st">"gam"</span>, <span class="no">nr</span>), <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="st">"brt"</span>, <span class="no">nr</span>), <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="st">"mlp"</span>, <span class="no">nr</span>))</pre></body></html></div>
<div id="plot-a-prediction" class="section level2">
<h2 class="hasAnchor">
<a href="#plot-a-prediction" class="anchor"></a>Plot a prediction</h2>
<p>Ploting the object will show the yearly averages.</p>
<div class="sourceCode" id="cb16"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(<span class="no">sim1</span>)</pre></body></html></div>
<p><img src="Fitting_SDMs_files/figure-html/plott_sim1-1.png" width="576"></p>
</div>
<div id="compare-abundance-predictons" class="section level2">
<h2 class="hasAnchor">
<a href="#compare-abundance-predictons" class="anchor"></a>Compare abundance predictons</h2>
<p>The function <code><a href="../reference/plot_abund.html">plot_abund()</a></code> will plot the average abundances of the true data (from simulation) and the fitted models. The required argument is the simulated data (<code>sim1</code>), after that you can add as many fitted (SDM) or prediction (POM) objects as you want to compare. We will use the prediction objects since we already have those and if we pass in the SDMs, the plotting function has to re-run the predictions.</p>
<div class="sourceCode" id="cb17"><html><body><pre class="r"><span class="fu"><a href="../reference/plot_abund.html">plot_abund</a></span>(<span class="no">sim1</span>, <span class="no">pred.gam2</span>, <span class="no">pred.mlp2</span>, <span class="no">pred.brt2</span>)</pre></body></html></div>
<p><img src="Fitting_SDMs_files/figure-html/plot-abund1-1.png" width="576"></p>
</div>
<div id="calculate-and-plot-centre-of-gravity" class="section level2">
<h2 class="hasAnchor">
<a href="#calculate-and-plot-centre-of-gravity" class="anchor"></a>Calculate and plot centre of gravity</h2>
<p>The function <code><a href="../reference/plot_cog.html">plot_cog()</a></code> will plot the center of gravity of the true data (from the simulation) and the fitted models. The required argument is the simulated data (<code>sim1</code>), after that you can add as many fitted or prediction objects as you want to compare.</p>
<div class="sourceCode" id="cb18"><html><body><pre class="r"><span class="fu"><a href="../reference/plot_cog.html">plot_cog</a></span>(<span class="no">sim1</span>, <span class="no">pred.gam2</span>, <span class="no">pred.mlp2</span>, <span class="no">pred.brt2</span>)</pre></body></html></div>
<p><img src="Fitting_SDMs_files/figure-html/plot-cog1-1.png" width="576"></p>
</div>
<div id="plot-average-presence" class="section level2">
<h2 class="hasAnchor">
<a href="#plot-average-presence" class="anchor"></a>Plot average presence</h2>
<p>The function <code><a href="../reference/plot_pres.html">plot_pres()</a></code> will plot the average presence.</p>
<div class="sourceCode" id="cb19"><html><body><pre class="r"><span class="fu"><a href="../reference/plot_pres.html">plot_pres</a></span>(<span class="no">sim1</span>, <span class="no">pred.gam2</span>, <span class="no">pred.mlp2</span>, <span class="no">pred.brt2</span>)</pre></body></html></div>
<p><img src="Fitting_SDMs_files/figure-html/plot-pres1-1.png" width="576"></p>
</div>
<div id="plot-abundance-on-a-grid" class="section level2">
<h2 class="hasAnchor">
<a href="#plot-abundance-on-a-grid" class="anchor"></a>Plot abundance on a grid</h2>
<p>These are point predictions of abundance for individual cells. We will show this for a particular year, in this case 2021.</p>
<div class="sourceCode" id="cb20"><html><body><pre class="r"><span class="fu"><a href="../reference/plot_grid.html">plot_grid</a></span>(<span class="no">sim1</span>, <span class="kw">year</span><span class="kw">=</span><span class="fl">2021</span>, <span class="no">pred.gam</span>, <span class="no">pred.mlp</span>, <span class="no">pred.brt</span>)</pre></body></html></div>
<p><img src="Fitting_SDMs_files/figure-html/plot-grid1-1.png" width="576"></p>
<div class="sourceCode" id="cb21"><html><body><pre class="r"># You can also pass in SDMs but the predictions will be computed (slow)
# plot_grid(sim1, year=2021, gam.fit, mlp.fit, brt.fit)</pre></body></html></div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Stephanie Brodie, James Smith, Eli Holmes.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.0.9000.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
